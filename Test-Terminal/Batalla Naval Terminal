#include <iostream>
#include <string>
using namespace std;

struct Jugador  {
    int vidas ;
    string fila[8] = {"A", "B", "C", "D", "E", "F", "G", "H"};
    string columna[8] = {"1", "2", "3", "4", "5", "6", "7", "8"};
    string matriz[9][9];
    bool turno = false;
};

void dibujar(string jugador[9][9],string jugador2[9][9]) {
	cout<<"Jugador 1:"<<endl;
    for (int i = 0; i < 9; i++) {
        for (int j = 0; j < 9; j++) {
            cout << jugador[i][j] << " ";
        }
        cout << endl;
    }
    cout<<"Jugador 2:"<<endl;
    for (int i = 0; i < 9; i++) {
        for (int j = 0; j < 9; j++) {
            cout << jugador2[i][j] << " ";
        }
        cout << endl;
    }
}

int checkear(int fila, int columna, string jugador[9][9], int& vidas) {
    if (jugador[fila][columna] == "B") {
        cout << "Le acertaste a un barco" << endl;
        jugador[fila][columna] = "X";
        vidas--;
        if (vidas == 0) {
            cout << "Te moriste" << endl;
            return 0;
        } else {
            return vidas;
        }
    } else {
        cout << "Fallaste!" << endl;
        return vidas;
    }
}

void disparar(string columna[], string fila[], string jugador[9][9], int& vidas,bool turno) {
    string disparo; 
     int conf = 0;

    while (conf == 0) {
        cout << "Ingrese la fila y columna a la que va a disparar: ";
        cin >> disparo;

        if (disparo.length() != 2) {
            cout << "No ingresaste 1 caracter y letra, vuelva a intentarlo" << endl;
            disparar(columna,  fila,  jugador, vidas, turno);
        }

        char row = disparo[0];
        char col = disparo[1];

        bool validRow = false;
        bool validCol = false;
        for (int i = 0; i < 8; i++) {
            if (row == fila[i][0]) {
                validRow = true;
            }
            if (col == columna[i][0]) {
                validCol = true;
            }
        }

        if (!validRow || !validCol) {
            cout << "No se encontro la fila o columna" << endl;
           disparar(columna,  fila,  jugador, vidas, turno);
        }

        int rowIndex = row - 'A' + 1;
        int colIndex = col - '1' + 1;

        cout << "Disparo registrado en la fila " << row << " y columna " << col << endl;
        conf =1;

        int result = checkear(rowIndex, colIndex, jugador, vidas);
        cout << "Vidas restantes: " << vidas << endl;
        turno = !turno;
    
}

}

void poner_barco(string jugador[9][9], string barco[], int barcoSize, string fila[], string columna[]) {
    cout << "El barco que vas a poner ocupa " << barcoSize << " casillas" << endl;

    bool rotar; int num;
    cout << "Quiere rotar el barco verticalmente? (1 si, 0 no): ";
    cin >>num;
    if(num == 0 || num == 1)
    rotar = num;

    string disparo;
    cout << "Ingrese la fila y columna en la que va a poner el inicio del barco: ";
    cin >> disparo;

    if (disparo.length() != 2) {
        cout << "No ingresaste 1 caracter y letra, vuelva a intentarlo" << endl;
        poner_barco(jugador, barco, barcoSize, fila, columna);
        return;
    }

    char row = disparo[0];
    char col = disparo[1];

    bool validRow = false;
    bool validCol = false;
    int rowIndex, colIndex;
    for (int i = 0; i < 8; i++) {
        if (row == fila[i][0]) {
            validRow = true;
            rowIndex = i + 1;
        }
        if (col == columna[i][0]) {
            validCol = true;
            colIndex = i + 1;
        }
    }

    if (!validRow || !validCol) {
        cout << "Fila o columna no válidas, vuelva a intentarlo" << endl;
        poner_barco(jugador, barco, barcoSize, fila, columna);
        return;
    }

    if ((rowIndex + barcoSize >= 9 && !rotar) || (colIndex + barcoSize >= 9 && rotar)) {
        cout << "El barco no cabe en esa posicion, vuelva a intentarlo" << endl;
        poner_barco(jugador, barco, barcoSize, fila, columna);
        return;
    }


    for (int i = 0; i < barcoSize; i++) {
        if (rotar) {
            jugador[rowIndex + i][colIndex] = barco[i];
        } else {
            jugador[rowIndex][colIndex + i] = barco[i];
        }
    }

    cout << "Barco colocado en la fila " << row << " y columna " << col << endl;
    dibujar(jugador,jugador);
}

void armar_campo(string jugador[9][9], string fila[], string columna[]) {
    string destructor[] = {"B", "B"};
    string submarino[] = {"B", "B", "B"};
    string crucero[] = {"B", "B", "B"};
    string acorazado[] = {"B", "B", "B", "B"};
    string carrier[] = {"B", "B", "B", "B", "B"};

    int barc;
    int guardar[5];
    int camt = 1;

    while (camt != 0) {
        cout << "Vamos a poner nuestros barcos en la jugador, ingrese un numero para mover un barco (1 destructor, 2 submarino, 3 crucero, 4 acorazado, 5 carrier)" << endl;
        cin >> barc;

        bool posicionado = false;
        for(int i=0;i<5;i++){
            if(barc == guardar[i]){
            cout<<"Ya posicionaste tu barco"<<endl;
            posicionado = true;
            break;
            }
        }

        if(posicionado)
        continue;
        switch (barc) {
            case 1: 
                poner_barco(jugador, destructor, 2, fila, columna);
                break;
            case 2: 
                poner_barco(jugador, submarino, 3, fila, columna);
                break;
            case 3: 
                poner_barco(jugador, crucero, 3, fila, columna);
                break;
            case 4: 
                poner_barco(jugador, acorazado, 4, fila, columna);
                break;
            case 5: 
                poner_barco(jugador, carrier, 5, fila, columna);
                break;
            default:
                cout << "Opción no válida" << endl;
                continue;
        }
        guardar[5-camt] = barc;
        camt--;
    }
}


 void  turno(Jugador& jugador1, Jugador& jugador2 ){
 	int turno=0;
 	while(jugador1.vidas !=0 || jugador2.vidas !=0){
 		turno++;
 		cout<<"Estamos en el turno: "<<turno<<endl;
 		cout<<"El jugador es"<<  jugador1.turno ? jugador1 : jugador2;
 		
 	if(jugador1.turno){
 	dibujar(jugador1.matriz,jugador2.matriz);
 	if(turno ==1){
    armar_campo(jugador1.matriz, jugador1.fila, jugador1.columna);}
    disparar(jugador1.columna, jugador1.fila, jugador1.matriz, jugador1.vidas,jugador1.turno);	
 	}
 	else{
 	dibujar(jugador2.matriz,jugador2.matriz);
   	if(turno ==1){
    armar_campo(jugador2.matriz, jugador2.fila, jugador2.columna);}
    disparar(jugador2.columna, jugador2.fila, jugador2.matriz, jugador2.vidas,jugador2.turno);	
	 }
 		
 		
	 }
 	
 	
 	
 }

int main() {
    Jugador jugador1;
    jugador1.vidas = 2;
    jugador1.turno = true;
    Jugador jugador2;
      jugador2.vidas = 2;

    cout << "Hola, estas jugando a batalla naval" << endl;

    for (int i = 0; i < 9; i++) {
        for (int j = 0; j < 9; j++) {
            jugador1.matriz[i][j] = " ";
        }
    }

    for (int i = 1; i < 9; i++) {
        jugador1.matriz[0][i] = jugador1.columna[i-1];
    }

    for (int j = 1; j < 9; j++) {
        jugador1.matriz[j][0] = jugador1.fila[j-1];
    }
    for (int i = 0; i < 9; i++) {
        for (int j = 0; j < 9; j++) {
            jugador2.matriz[i][j] = " ";
        }
    }

    for (int i = 1; i < 9; i++) {
        jugador2.matriz[0][i] = jugador1.columna[i-1];
    }

    for (int j = 1; j < 9; j++) {
        jugador2.matriz[j][0] = jugador1.fila[j-1];
    }
    
    turno(jugador1,jugador2);
    

    
    return 0;
}
